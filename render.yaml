services:
  # PostgreSQL Database
  - type: psql
    name: medical-records-db
    plan: free
    databaseName: medical_records
    databaseUser: medical_user

  # Backend API Service
  - type: web
    name: medical-records-backend
    env: go
    region: oregon
    plan: free
    buildCommand: cd backend && go mod download && go build -o ../bin/server ./cmd/server
    startCommand: ./bin/server
    envVars:
      - key: DB_HOST
        fromDatabase:
          name: medical-records-db
          property: host
      - key: DB_PORT
        fromDatabase:
          name: medical-records-db
          property: port
      - key: DB_USER
        fromDatabase:
          name: medical-records-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: medical-records-db
          property: password
      - key: DB_NAME
        fromDatabase:
          name: medical-records-db
          property: database
      - key: DB_SSLMODE
        value: require
      - key: SERVER_PORT
        value: 8080
      - key: JWT_SECRET
        generateValue: true
      - key: JWT_EXPIRATION_HOURS
        value: 24
      - key: APP_ENV
        value: production
      - key: APP_DEBUG
        value: false

  # Frontend Service
  - type: web
    name: medical-records-frontend
    env: node
    region: oregon
    plan: free
    buildCommand: cd frontend && npm install && npm run build
    startCommand: cd frontend && npx serve -s build -l 3000
    envVars:
      - key: REACT_APP_API_URL
        fromService:
          name: medical-records-backend
          type: web
          property: host
        value: https://medical-records-backend.onrender.com/api/v1
    staticPublishPath: ./frontend/build

